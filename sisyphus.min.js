(function(e){e.fn.sisyphus=function(t){var n=e.map(this,function(t,n){return e(t).attr("id")+e(t).attr("name")}).join();var r=Sisyphus.getInstance(n);r.protect(this,t);return r};var t={};t.isAvailable=function(){if(typeof e.jStorage==="object"){return true}try{return localStorage.getItem}catch(t){return false}};t.set=function(t,n){if(typeof e.jStorage==="object"){e.jStorage.set(t,n+"")}else{try{localStorage.setItem(t,n+"")}catch(r){}}};t.get=function(t){if(typeof e.jStorage==="object"){var n=e.jStorage.get(t);return n?n.toString():n}else{return localStorage.getItem(t)}};t.remove=function(t){if(typeof e.jStorage==="object"){e.jStorage.deleteKey(t)}else{localStorage.removeItem(t)}};Sisyphus=function(){function r(){return{setInstanceIdentifier:function(e){this.identifier=e},getInstanceIdentifier:function(){return this.identifier},setInitialOptions:function(n){var r={excludeFields:[],customKeySuffix:"",locationBased:false,timeout:0,autoRelease:true,onSave:function(){},onBeforeRestore:function(){},onRestore:function(){},onRelease:function(){}};this.options=this.options||e.extend(r,n);this.browserStorage=t},setOptions:function(t){this.options=this.options||this.setInitialOptions(t);this.options=e.extend(this.options,t)},protect:function(t,r){this.setOptions(r);t=t||{};var i=this;this.targets=this.targets||[];this.href=location.hostname+location.pathname+location.search+location.hash;this.targets=e.merge(this.targets,t);this.targets=e.unique(this.targets);this.targets=e(this.targets);if(!this.browserStorage.isAvailable()){return false}var s=i.options.onBeforeRestore.call(i);if(s===undefined||s){i.restoreAllData()}if(this.options.autoRelease){i.bindReleaseData()}if(!n.started[this.getInstanceIdentifier()]){if(i.isCKEditorPresent()){var o=setInterval(function(){if(CKEDITOR.isLoaded){clearInterval(o);i.bindSaveData();n.started[i.getInstanceIdentifier()]=true}},100)}else{i.bindSaveData();n.started[i.getInstanceIdentifier()]=true}}},isCKEditorPresent:function(){if(this.isCKEditorExists()){CKEDITOR.isLoaded=false;CKEDITOR.on("instanceReady",function(){CKEDITOR.isLoaded=true});return true}else{return false}},isCKEditorExists:function(){return typeof CKEDITOR!="undefined"},findFieldsToProtect:function(e){return e.find(":input").not(":submit").not(":reset").not(":button").not(":file").not(":password").not(":disabled").not("[readonly]")},bindSaveData:function(){var t=this;if(t.options.timeout){t.saveDataByTimeout()}t.targets.each(function(){var n=e(this).attr("id")+e(this).attr("name");t.findFieldsToProtect(e(this)).each(function(){if(e.inArray(this,t.options.excludeFields)!==-1){return true}var r=e(this);var i=(t.options.locationBased?t.href:"")+n+r.attr("name")+t.options.customKeySuffix;if(r.is(":text")||r.is("textarea")){if(!t.options.timeout){t.bindSaveDataImmediately(r,i)}}t.bindSaveDataOnChange(r)})})},saveAllData:function(){var t=this;t.targets.each(function(){var n=e(this).attr("id")+e(this).attr("name");var r={};t.findFieldsToProtect(e(this)).each(function(){var i=e(this);if(e.inArray(this,t.options.excludeFields)!==-1||i.attr("name")===undefined){return true}var s=(t.options.locationBased?t.href:"")+n+i.attr("name")+t.options.customKeySuffix;var o=i.val();if(i.is(":checkbox")){if(i.attr("name").indexOf("[")!==-1){if(r[i.attr("name")]===true){return}o=[];e("[name='"+i.attr("name")+"']:checked").each(function(){o.push(e(this).val())});r[i.attr("name")]=true}else{o=i.is(":checked")}t.saveToBrowserStorage(s,o,false)}else if(i.is(":radio")){if(i.is(":checked")){o=i.val();t.saveToBrowserStorage(s,o,false)}}else{if(t.isCKEditorExists()){var u;if(u=CKEDITOR.instances[i.attr("name")]||CKEDITOR.instances[i.attr("id")]){u.updateElement();t.saveToBrowserStorage(s,i.val(),false)}else{t.saveToBrowserStorage(s,o,false)}}else{t.saveToBrowserStorage(s,o,false)}}})});t.options.onSave.call(t)},hasDataToRestore:function(){var t=this;var n=false;t.targets.each(function(){var r=e(this).attr("id")+e(this).attr("name");t.findFieldsToProtect(e(this)).each(function(){if(e.inArray(this,t.options.excludeFields)!==-1){return true}else{var i=e(this);var s=(t.options.locationBased?t.href:"")+r+i.attr("name")+t.options.customKeySuffix;var o=t.browserStorage.get(s);if(o!==null){n=true;return false}}})});return n},restoreAllData:function(){var t=this;var n=false;t.targets.each(function(){var r=e(this);var i=e(this).attr("id")+e(this).attr("name");t.findFieldsToProtect(r).each(function(){if(e.inArray(this,t.options.excludeFields)!==-1){return true}var r=e(this);var s=(t.options.locationBased?t.href:"")+i+r.attr("name")+t.options.customKeySuffix;var o=t.browserStorage.get(s);if(o!==null){t.restoreFieldsData(r,o);n=true}})});if(n){t.options.onRestore.call(t)}},restoreFieldsData:function(e,t){if(e.attr("name")===undefined){return false}if(e.is(":checkbox")&&t!=="false"&&e.attr("name").indexOf("[")===-1){e.attr("checked","checked")}else if(e.is(":checkbox")&&t==="false"&&e.attr("name").indexOf("[")===-1){e.removeAttr("checked")}else if(e.is(":radio")){if(e.val()===t){e.attr("checked","checked")}}else if(e.attr("name").indexOf("[")===-1){e.val(t)}else{t=t.split(",");e.val(t)}},bindSaveDataImmediately:function(e,t){var n=this;if("onpropertychange"in e){e.get(0).onpropertychange=function(){n.saveToBrowserStorage(t,e.val())}}else{e.get(0).oninput=function(){n.saveToBrowserStorage(t,e.val())}}if(this.isCKEditorExists()){var r;if(r=CKEDITOR.instances[e.attr("name")]||CKEDITOR.instances[e.attr("id")]){r.document.on("keyup",function(){r.updateElement();n.saveToBrowserStorage(t,e.val())})}}},saveToBrowserStorage:function(e,t,n){n=n===undefined?true:n;this.browserStorage.set(e,t);if(n&&t!==""){this.options.onSave.call(this)}},bindSaveDataOnChange:function(e){var t=this;e.change(function(){t.saveAllData()})},saveDataByTimeout:function(){var e=this;var t=e.targets;setTimeout(function(){function t(){e.saveAllData();setTimeout(t,e.options.timeout*1e3)}return t}(t),e.options.timeout*1e3)},bindReleaseData:function(){var t=this;t.targets.each(function(){var n=e(this);var r=n.attr("id")+n.attr("name");e(this).bind("submit reset",function(){t.releaseData(r,t.findFieldsToProtect(n))})})},manuallyReleaseData:function(){var t=this;t.targets.each(function(){var n=e(this);var r=n.attr("id")+n.attr("name");t.releaseData(r,t.findFieldsToProtect(n))})},releaseData:function(t,r){var i=false;var s=this;n.started[s.getInstanceIdentifier()]=false;r.each(function(){if(e.inArray(this,s.options.excludeFields)!==-1){return true}var n=e(this);var r=(s.options.locationBased?s.href:"")+t+n.attr("name")+s.options.customKeySuffix;s.browserStorage.remove(r);i=true});if(i){s.options.onRelease.call(s)}}}}var n={instantiated:[],started:[]};return{getInstance:function(e){if(!n.instantiated[e]){n.instantiated[e]=r();n.instantiated[e].setInstanceIdentifier(e);n.instantiated[e].setInitialOptions()}if(e){return n.instantiated[e]}return n.instantiated[e]},free:function(){n={instantiated:[],started:[]};return null},version:"1.1.107"}}()})(jQuery);