(function(n){"use strict";var r;n.sisyphus=function(){return r.getInstance()},n.fn.sisyphus=function(n){var t=r.getInstance();return t.setOptions(n),t.protect(this),t};var i={},u=n.fn.on?"on":"bind",t=null;i.isAvailable=function(){if(typeof n.jStorage=="object")return!0;try{return localStorage.getItem}catch(t){return!1}},i.set=function(t,i){if(typeof n.jStorage=="object")n.jStorage.set(t,i+"");else try{localStorage.setItem(t,i+"")}catch(r){}},i.get=function(t){if(typeof n.jStorage=="object"){var i=n.jStorage.get(t);return i?i.toString():i}return localStorage.getItem(t)},i.remove=function(t){typeof n.jStorage=="object"?n.jStorage.deleteKey(t):localStorage.removeItem(t)},r=function(){function f(){return{setInitialOptions:function(t){var r={excludeFields:[],customKeyPrefix:"",timeout:0,autoRelease:!0,name:null,onBeforeTextSave:function(){},onBeforeSave:function(){},onSave:function(){},onBeforeRestore:function(){},onRestore:function(){},onRelease:function(){}};this.options=this.options||n.extend(r,t),this.browserStorage=i},setOptions:function(t){this.options=this.options||this.setInitialOptions(t),this.options=n.extend(this.options,t)},protect:function(t){t=t||{};var i=this;if(this.targets=this.targets||[],this.href=this.options.name||location.hostname+location.pathname+location.search+location.hash,this.targets=n.merge(this.targets,t),this.targets=n.unique(this.targets),this.targets=n(this.targets),!this.browserStorage.isAvailable())return!1;i.restoreAllData(),this.options.autoRelease&&i.bindReleaseData(),r.started||(i.bindSaveData(),r.started=!0)},bindSaveData:function(){var t=this;t.options.timeout&&t.saveDataByTimeout(),t.targets.each(function(){var i=n(this).attr("id"),r=n(this).find(":input[type!='hidden']").not(":submit").not(":reset").not(":button").not(":file");r.each(function(){if(n.inArray(this,t.options.excludeFields)!==-1)return!0;var r=n(this),u=t.href+i+r.attr("name")+t.options.customKeyPrefix;r.is(":text")||r.is("textarea")?t.options.timeout||t.bindSaveDataImmediately(r,u):t.bindSaveDataOnChange(r,u)})})},saveAllData:function(){var t=this;n.isFunction(t.options.onBeforeSave)&&t.options.onBeforeSave.call(),t.targets.each(function(){var i=n(this).attr("id"),r=n(this).find(":input[type!='hidden']").not(":submit").not(":reset").not(":button").not(":file");r.each(function(){var r=n(this),f,u;if(n.inArray(this,t.options.excludeFields)!==-1||r.attr("name")===undefined)return!0;f=t.href+i+r.attr("name")+t.options.customKeyPrefix,u=r.val(),r.is(":checkbox")?(r.attr("name").indexOf("[")!==-1?(u=[],n("[name='"+r.attr("name")+"']:checked").each(function(){u.push(n(this).val())})):u=r.is(":checked"),t.saveToBrowserStorage(f,u,!1)):r.is(":radio")?r.is(":checked")&&(u=r.val(),t.saveToBrowserStorage(f,u,!1)):t.saveToBrowserStorage(f,u,!1)})}),n.isFunction(t.options.onSave)&&t.options.onSave.call()},restoreAllData:function(){var t=this,i=!1;n.isFunction(t.options.onBeforeRestore)&&t.options.onBeforeRestore.call(t),t.targets.each(function(){var r=n(this),u=r.attr("id"),f=r.find(":input[type!='hidden']").not(":submit").not(":reset").not(":button").not(":file");f.each(function(){if(n.inArray(this,t.options.excludeFields)!==-1)return!0;var r=n(this),e=t.href+u+r.attr("name")+t.options.customKeyPrefix,f=t.browserStorage.get(e);f!==null&&(t.restoreFieldsData(r,f),i=!0)})}),i&&n.isFunction(t.options.onRestore)&&t.options.onRestore.call()},restoreFieldsData:function(n,t){if(n.attr("name")===undefined)return!1;n.is(":checkbox")&&t!=="false"&&n.attr("name").indexOf("[")===-1?n.attr("checked","checked"):n.is(":checkbox")&&t==="false"&&n.attr("name").indexOf("[")===-1?n.removeAttr("checked"):n.is(":radio")?n.val()===t&&n.attr("checked","checked"):n.attr("name").indexOf("[")===-1?n.val(t):(t=t.split(","),n.val(t))},bindSaveDataImmediately:function(i,r){var f=this;i[u]("textsave.sisyphus",{field:i,prefix:r},function(t){n.isFunction(f.options.onBeforeTextSave)&&f.options.onBeforeTextSave.call(t.data.field),f.saveToBrowserStorage(t.data.prefix,t.data.field.val())}),i.get(0).oninput=function(){t||(t="oninput"),t==="oninput"&&(n.isFunction(f.options.onBeforeTextSave)&&f.options.onBeforeTextSave.call(f),f.saveToBrowserStorage(r,i.val()))},i.get(0).onpropertychange=function(){t||(t="onpropertychange"),t==="onpropertychange"&&(n.isFunction(f.options.onBeforeTextSave)&&f.options.onBeforeTextSave.call(f),f.saveToBrowserStorage(r,i.val()))}},saveToBrowserStorage:function(t,i,r){r=r===undefined?!0:r,this.browserStorage.set(t,i),r&&i!==""&&n.isFunction(this.options.onSave)&&this.options.onSave.call()},bindSaveDataOnChange:function(n){var t=this;n.change(function(){t.saveAllData()})},saveDataByTimeout:function(){var n=this;setTimeout(function(){function t(){n.saveAllData(),setTimeout(t,n.options.timeout*1e3)}return t}(),n.options.timeout*1e3)},bindReleaseData:function(){var t=this;t.targets.each(function(){var i=n(this),r=i.find(":input").not(":submit").not(":reset").not(":button").not(":file"),u=i.attr("id");n(this).bind("submit reset",function(){t.releaseData(u,r)})})},manuallyReleaseData:function(){var t=this;t.targets.each(function(){var i=n(this),r=i.find(":input").not(":submit").not(":reset").not(":button").not(":file"),u=i.attr("id");t.releaseData(u,r)})},releaseData:function(t,i){var u=!1,r=this;i.each(function(){if(n.inArray(this,r.options.excludeFields)!==-1)return!0;var i=n(this),f=r.href+t+i.attr("name")+r.options.customKeyPrefix;r.browserStorage.remove(f),u=!0}),u&&n.isFunction(r.options.onRelease)&&r.options.onRelease.call()}}}var r={instantiated:null,started:null};return{getInstance:function(){return r.instantiated||(r.instantiated=f(),r.instantiated.setInitialOptions()),r.instantiated},free:function(){return r={},null}}}()})(jQuery);
//@ sourceMappingURL=sisyphus.min.js.map