(function(e){e.sisyphus=function(){return Sisyphus.getInstance()},e.fn.sisyphus=function(e){var t=Sisyphus.getInstance();return t.setOptions(e),t.protect(this),t};var t={};t.isAvailable=function(){if(typeof e.jStorage=="object")return!0;try{return localStorage.getItem}catch(t){return!1}},t.set=function(t,n){if(typeof e.jStorage=="object")e.jStorage.set(t,n+"");else try{localStorage.setItem(t,n+"")}catch(r){}},t.get=function(t){if(typeof e.jStorage=="object"){var n=e.jStorage.get(t);return n?n.toString():n}return localStorage.getItem(t)},t.remove=function(t){typeof e.jStorage=="object"?e.jStorage.deleteKey(t):localStorage.removeItem(t)},Sisyphus=function(){function r(){return{setInitialOptions:function(n){var r={excludeFields:[],customKeyPrefix:"",timeout:0,autoRelease:!0,name:null,onSave:function(){},onBeforeRestore:function(){},onRestore:function(){},onRelease:function(){}};this.options=this.options||e.extend(r,n),this.browserStorage=t},setOptions:function(t){this.options=this.options||this.setInitialOptions(t),this.options=e.extend(this.options,t)},protect:function(t){t=t||{};var r=this;this.targets=this.targets||[],this.href=this.options.name||location.hostname+location.pathname+location.search+location.hash,this.targets=e.merge(this.targets,t),this.targets=e.unique(this.targets),this.targets=e(this.targets);if(!this.browserStorage.isAvailable())return!1;r.restoreAllData(),this.options.autoRelease&&r.bindReleaseData(),n.started||(r.bindSaveData(),n.started=!0)},bindSaveData:function(){var t=this;t.options.timeout&&t.saveDataByTimeout(),t.targets.each(function(){var n=e(this).attr("id"),r=e(this).find(":input").not(":submit").not(":reset").not(":button").not(":file");r.each(function(){if(e.inArray(this,t.options.excludeFields)!==-1)return!0;var r=e(this),i=t.href+n+r.attr("name")+t.options.customKeyPrefix;r.is(":text")||r.is("textarea")?t.options.timeout||t.bindSaveDataImmediately(r,i):t.bindSaveDataOnChange(r,i)})})},saveAllData:function(){var t=this;t.targets.each(function(){var n=e(this).attr("id"),r=e(this).find(":input").not(":submit").not(":reset").not(":button").not(":file");r.each(function(){var r=e(this);if(e.inArray(this,t.options.excludeFields)!==-1||r.attr("name")===undefined)return!0;var i=t.href+n+r.attr("name")+t.options.customKeyPrefix,s=r.val();r.is(":checkbox")?(r.attr("name").indexOf("[")!==-1?(s=[],e("[name='"+r.attr("name")+"']:checked").each(function(){s.push(e(this).val())})):s=r.is(":checked"),t.saveToBrowserStorage(i,s,!1)):r.is(":radio")?r.is(":checked")&&(s=r.val(),t.saveToBrowserStorage(i,s,!1)):t.saveToBrowserStorage(i,s,!1)})}),e.isFunction(t.options.onSave)&&t.options.onSave.call()},restoreAllData:function(){var t=this,n=!1;e.isFunction(t.options.onBeforeRestore)&&t.options.onBeforeRestore.call(),t.targets.each(function(){var r=e(this),i=r.attr("id"),s=r.find(":input").not(":submit").not(":reset").not(":button").not(":file");s.each(function(){if(e.inArray(this,t.options.excludeFields)!==-1)return!0;var r=e(this),s=t.href+i+r.attr("name")+t.options.customKeyPrefix,o=t.browserStorage.get(s);o&&(t.restoreFieldsData(r,o),n=!0)})}),n&&e.isFunction(t.options.onRestore)&&t.options.onRestore.call()},restoreFieldsData:function(e,t){if(e.attr("name")===undefined)return!1;e.is(":checkbox")&&t!=="false"&&e.attr("name").indexOf("[")===-1?e.attr("checked","checked"):e.is(":checkbox")&&t==="false"&&e.attr("name").indexOf("[")===-1?e.removeAttr("checked"):e.is(":radio")?e.val()===t&&e.attr("checked","checked"):e.attr("name").indexOf("[")===-1?e.val(t):(t=t.split(","),e.val(t))},bindSaveDataImmediately:function(t,n){var r=this;e.browser.msie===null?t.get(0).oninput=function(){r.saveToBrowserStorage(n,t.val())}:t.get(0).onpropertychange=function(){r.saveToBrowserStorage(n,t.val())}},saveToBrowserStorage:function(t,n,r){r=r===null?!0:r,this.browserStorage.set(t,n),r&&n!==""&&e.isFunction(this.options.onSave)&&this.options.onSave.call()},bindSaveDataOnChange:function(e,t){var n=this;e.change(function(){n.saveAllData()})},saveDataByTimeout:function(){var e=this,t=e.targets;setTimeout(function(t){function n(){e.saveAllData(),setTimeout(n,e.options.timeout*1e3)}return n}(t),e.options.timeout*1e3)},bindReleaseData:function(){var t=this;t.targets.each(function(n){var r=e(this),i=r.find(":input").not(":submit").not(":reset").not(":button").not(":file"),s=r.attr("id");e(this).bind("submit reset",function(){t.releaseData(s,i)})})},manuallyReleaseData:function(){var t=this;t.targets.each(function(n){var r=e(this),i=r.find(":input").not(":submit").not(":reset").not(":button").not(":file"),s=r.attr("id");t.releaseData(s,i)})},releaseData:function(t,n){var r=!1,i=this;n.each(function(){if(e.inArray(this,i.options.excludeFields)!==-1)return!0;var n=e(this),s=i.href+t+n.attr("name")+i.options.customKeyPrefix;i.browserStorage.remove(s),r=!0}),r&&e.isFunction(i.options.onRelease)&&i.options.onRelease.call()}}}var n={instantiated:null,started:null};return{getInstance:function(){return n.instantiated||(n.instantiated=r(),n.instantiated.setInitialOptions()),n.instantiated},free:function(){return n={},null}}}()})(jQuery)