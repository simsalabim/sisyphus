!function(t){function e(t){return"[id="+t.attr("id")+"][name="+t.attr("name")+"]"}t.fn.sisyphus=function(i){var n=t.map(this,function(i){return e(t(i))}).join(),o=Sisyphus.getInstance(n);return o.protect(this,i),o};var i,n,o={};o.isAvailable=function(){if("object"==typeof t.jStorage)return!0;try{return localStorage.getItem}catch(e){return!1}},o.set=function(e,i){if("object"==typeof t.jStorage)t.jStorage.set(e,i+"");else try{localStorage.setItem(e,i+"")}catch(n){}},o.get=function(e){if("object"!=typeof t.jStorage)return localStorage.getItem(e);var i=t.jStorage.get(e);return i?i.toString():i},o.remove=function(e){"object"==typeof t.jStorage?t.jStorage.deleteKey(e):localStorage.removeItem(e)},Sisyphus=(i={instantiated:[],started:[]},n=window.CKEDITOR,{getInstance:function(a){return i.instantiated[a]||(i.instantiated[a]={setInstanceIdentifier:function(t){this.identifier=t},getInstanceIdentifier:function(){return this.identifier},setInitialOptions:function(e){this.options=this.options||t.extend({excludeFields:[],customKeySuffix:"",locationBased:!1,timeout:0,autoRelease:!0,onBeforeSave:function(){},onSave:function(){},onBeforeRestore:function(){},onRestore:function(){},onRelease:function(){}},e),this.browserStorage=o},setOptions:function(e){this.options=this.options||this.setInitialOptions(e),this.options=t.extend(this.options,e)},protect:function(e,o){this.setOptions(o),e=e||{};var a=this;if(this.targets=this.targets||[],a.options.name?this.href=a.options.name:this.href=location.hostname+location.pathname+location.search+location.hash,this.targets=t.merge(this.targets,e),this.targets=t.uniqueSort(this.targets),this.targets=t(this.targets),!this.browserStorage.isAvailable())return!1;var s=a.options.onBeforeRestore.call(a);if((void 0===s||s)&&a.restoreAllData(),this.options.autoRelease&&a.bindReleaseData(),!i.started[this.getInstanceIdentifier()]){if(a.isCKEditorPresent())var r=setInterval(function(){n.isLoaded&&(clearInterval(r),a.bindSaveData(),i.started[a.getInstanceIdentifier()]=!0)},100);else a.bindSaveData(),i.started[a.getInstanceIdentifier()]=!0}},isCKEditorPresent:function(){return!!this.isCKEditorExists()&&(n.isLoaded=!1,n.on("instanceReady",function(){n.isLoaded=!0}),!0)},isCKEditorExists:function(){return void 0!==n},findFieldsToProtect:function(t){return t.find(":input").not(":submit").not(":reset").not(":button").not(":file").not(":password").not(":disabled").not("[readonly]")},bindSaveData:function(){var i=this;i.options.timeout&&i.saveDataByTimeout(),i.targets.each(function(){var n=e(t(this));i.findFieldsToProtect(t(this)).each(function(){if(-1!==t.inArray(this,i.options.excludeFields))return!0;var o=t(this),a=(i.options.locationBased?i.href:"")+n+e(o)+i.options.customKeySuffix;(o.is(":text")||o.is("textarea"))&&!i.options.timeout&&i.bindSaveDataImmediately(o,a),i.bindSaveDataOnChange(o)})})},saveAllData:function(){var i=this;i.targets.each(function(){var o=e(t(this)),a={};i.findFieldsToProtect(t(this)).each(function(){var s=t(this);if(-1!==t.inArray(this,i.options.excludeFields)||void 0===s.attr("name")&&void 0===s.attr("id"))return!0;var r=(i.options.locationBased?i.href:"")+o+e(s)+i.options.customKeySuffix,c=s.val();if(s.is(":checkbox")){var f=s.attr("name");if(void 0!==f&&-1!==f.indexOf("[")){if(!0===a[f])return;c=[],t("[name='"+f+"']:checked").each(function(){c.push(t(this).val())}),a[f]=!0}else c=s.is(":checked");i.saveToBrowserStorage(r,c,!1)}else if(s.is(":radio"))s.is(":checked")?(c=s.val(),i.saveToBrowserStorage(r,c,!1)):i.browserStorage.remove(r);else if(i.isCKEditorExists()){var d=n.instances[s.attr("name")]||n.instances[s.attr("id")];d?(d.updateElement(),i.saveToBrowserStorage(r,s.val(),!1)):i.saveToBrowserStorage(r,c,!1)}else i.saveToBrowserStorage(r,c,!1)})}),i.options.onSave.call(i)},restoreAllData:function(){var i=this,n=!1;i.targets.each(function(){var o=t(this),a=e(t(this));i.findFieldsToProtect(o).each(function(){if(-1!==t.inArray(this,i.options.excludeFields))return!0;var o=t(this),s=(i.options.locationBased?i.href:"")+a+e(o)+i.options.customKeySuffix,r=i.browserStorage.get(s);null!==r&&(i.restoreFieldsData(o,r),n=!0)})}),n&&i.options.onRestore.call(i)},restoreFieldsData:function(t,e){if(void 0===t.attr("name")&&void 0===t.attr("id"))return!1;var i=t.attr("name");t.is(":checkbox")&&"false"!==e&&(void 0===i||-1===i.indexOf("["))?t.prop("checked",!0):t.is(":checkbox")&&"false"===e&&(void 0===i||-1===i.indexOf("["))?t.prop("checked",!1):t.is(":radio")?t.val()===e&&t.prop("checked",!0):(void 0===i||-1===i.indexOf("[")||(e=e.split(",")),t.val(e))},bindSaveDataImmediately:function(t,e){var i=this;if("onpropertychange"in t?t.get(0).onpropertychange=function(){i.saveToBrowserStorage(e,t.val())}:t.get(0).oninput=function(){i.saveToBrowserStorage(e,t.val())},this.isCKEditorExists()){var o=n.instances[t.attr("name")]||n.instances[t.attr("id")];o&&o.document.on("keyup",function(){o.updateElement(),i.saveToBrowserStorage(e,t.val())})}},saveToBrowserStorage:function(t,e,i){var n=this.options.onBeforeSave.call(this);(void 0===n||!1!==n)&&(i=void 0===i||i,this.browserStorage.set(t,e),i&&""!==e&&this.options.onSave.call(this))},bindSaveDataOnChange:function(t){var e=this;t.on("change",function(){e.saveAllData()})},saveDataByTimeout:function(){var t=this;setTimeout(function(){function e(){t.saveAllData(),setTimeout(e,1e3*t.options.timeout)}return e}(t.targets),1e3*t.options.timeout)},bindReleaseData:function(){var i=this;i.targets.each(function(){var n=t(this),o=e(n);t(this).on("submit reset",function(){i.releaseData(o,i.findFieldsToProtect(n))})})},manuallyReleaseData:function(){var i=this;i.targets.each(function(){var n=t(this),o=e(n);i.releaseData(o,i.findFieldsToProtect(n))})},releaseData:function(n,o){var a=!1,s=this;i.started[s.getInstanceIdentifier()]=!1,o.each(function(){if(-1!==t.inArray(this,s.options.excludeFields))return!0;var i=t(this),o=(s.options.locationBased?s.href:"")+n+e(i)+s.options.customKeySuffix;s.browserStorage.remove(o),a=!0}),a&&s.options.onRelease.call(s)}},i.instantiated[a].setInstanceIdentifier(a),i.instantiated[a].setInitialOptions()),i.instantiated[a]},free:function(){return i={instantiated:[],started:[]},null},version:"1.1.3"})}(jQuery);